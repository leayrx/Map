<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Carte collaborative</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
}

#map {
  width: 100%;
  height: 100%;
}

/* CONTENEUR UI AU-DESSUS DE LA CARTE */
#ui-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 2000;
  pointer-events: none;
}

#ui-container > div {
  pointer-events: auto;
}

/* POPUP ROLE */
#role-popup, #login-popup, #red-popup {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 10px;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  display: none;
  z-index: 3000;
}

/* FORMULAIRE POINT ROUGE */
#red-form {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 10px;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}

#red-form input, #red-popup input {
  width: 90px;
}

/* SELECTEUR CALQUES GPX */
#layer-selector {
  position: absolute;
  top: 10px;
  right: 10px;
  background: white;
  padding: 8px;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}

/* POPUP INFO GPS */
#gps-warning {
  position: absolute;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  background: #e3f2fd;
  padding: 8px 12px;
  border-radius: 5px;
  font-weight: bold;
  box-shadow: 0 0 8px rgba(0,0,0,0.3);
  display: none;
}

/* BOUTON ADMIN BAS-DROITE */
#admin-btn-container {
  position: absolute;
  bottom: 10px;
  right: 10px;
  z-index: 3000;
}
#admin-btn-container button {
  padding: 6px 10px;
  font-weight: bold;
}
</style>
</head>

<body>

<div id="map"></div>

<div id="ui-container">

  <!-- ROLE SP / VICT -->
  <div id="role-popup">
    <strong>Choisissez votre rôle</strong><br><br>
    <button id="btn-sp">SP</button>
    <button id="btn-vict">VICT</button>
  </div>

  <!-- LOGIN SPALS -->
  <div id="login-popup">
    <strong>Connexion SPALS</strong><br><br>
    <input type="text" id="login-id" placeholder="Identifiant"><br><br>
    <input type="password" id="login-pass" placeholder="Mot de passe"><br><br>
    <button id="login-btn">Se connecter</button>
    <button id="login-cancel">Annuler</button>
    <p id="login-error" style="color:red; display:none;">Identifiant ou mot de passe incorrect</p>
  </div>

  <!-- MENU AJOUT POINT ROUGE -->
  <div id="red-popup">
    <strong>Ajouter un point rouge</strong><br><br>
    <input id="red-lat" placeholder="Lat">
    <input id="red-lng" placeholder="Lng"><br><br>
    <input id="red-title" placeholder="Légende">
    <input type="file" id="red-photo"><br><br>
    <button id="red-add-btn">Ajouter</button>
    <button id="red-close-btn">Fermer</button>
  </div>

  <!-- FORMULAIRE POINT ROUGE MANUEL -->
  <div id="red-form">
    <input id="lat-input" placeholder="Lat">
    <input id="lng-input" placeholder="Lng">
    <input id="red-name" placeholder="Nom">
    <button id="add-red-marker">Ajouter</button>
  </div>

  <!-- MENU GPX + BALISE -->
  <div id="layer-selector">
    <strong>Moyens</strong><br>
    <select id="layer" multiple size="8">
      <option value="PIETON">Piéton</option>
      <option value="VLI">VLI</option>
      <option value="VLTT">VLTT</option>
      <option value="VSAV">VSAV</option>
      <option value="CTU">CTU</option>
      <option value="FPT">FPT</option>
      <option value="CCF">CCF</option>
      <option value="BALISE">Balise</option>
    </select>
  </div>

  <!-- BOUTON ADMIN -->
  <div id="admin-btn-container">
    <button id="btn-admin">Admin</button>
  </div>

  <div id="gps-warning"></div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>
<script src="js/map.js"></script>

<script>
// bouton Admin ouvre le login
document.getElementById("btn-admin").onclick = () => {
  document.getElementById("login-popup").style.display = "block";
};
</script>

</body>
</html>
